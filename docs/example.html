
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project example &#8212; RobotBP 0.1 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Packages and Classes" href="classes.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="classes.html" title="Packages and Classes"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RobotBP 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Project example</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="project-example">
<span id="exampels"></span><h1>Project example<a class="headerlink" href="#project-example" title="Permalink to this headline">¶</a></h1>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">allEventsButBuildEventSet</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">EventSet</span><span class="p">(</span><span class="s2">&quot;Block all for build&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="s2">&quot;Build&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">dataEventSet</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">EventSet</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="s2">&quot;GetSensorsData&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">AlgorithmEventSet</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">EventSet</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="s2">&quot;GetAlgorithmResult&quot;</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">direction</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Do Something with Data&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;GrovePi&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;D2&quot;</span><span class="p">,</span> <span class="s2">&quot;D4&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">GrovePi</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">D4</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">){</span>
            <span class="nx">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">direction</span> <span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Just Right&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">EV3</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">_2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="o">&amp;&amp;</span> <span class="nx">distance</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">){</span>
            <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">}})});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Too Far Right&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">EV3</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">_2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">){</span>
            <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">}})});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Too Far Left&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">EV3</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">_2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">){</span>
            <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">}})});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Do My Algorithm&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;MyAlgorithm&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="mi">1</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Param1&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Param2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Param2_1&quot;</span> <span class="o">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">}}},</span> <span class="s2">&quot;GrovePi&quot;</span><span class="o">:</span> <span class="p">{</span><span class="mi">2</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Param3&quot;</span><span class="o">:</span> <span class="mi">100</span><span class="p">}}})});</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">AlgorithmEventSet</span><span class="p">});</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)});</span>
<span class="p">});</span>

<span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Initiation&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span>
        <span class="nx">block</span><span class="o">:</span> <span class="nx">allEventsButBuildEventSet</span><span class="p">,</span> <span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Build&quot;</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s2">&quot;EV3&quot;</span><span class="o">:</span>
                    <span class="p">[{</span>
                        <span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;EV3_1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Port&quot;</span><span class="o">:</span> <span class="s2">&quot;rfcomm0&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;UV3&quot;</span><span class="p">}</span>
                    <span class="p">}]</span>
                <span class="p">,</span>
                <span class="s2">&quot;GrovePi&quot;</span><span class="o">:</span>
                    <span class="p">[{</span>
                        <span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;GrovePi1&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;A0&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
                        <span class="s2">&quot;A1&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;A2&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;D2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;MyLed&quot;</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="o">:</span> <span class="s2">&quot;Led&quot;</span><span class="p">},</span>
                        <span class="s2">&quot;D3&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;D4&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;UV&quot;</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="o">:</span> <span class="s2">&quot;Ultrasonic&quot;</span><span class="p">},</span>
                        <span class="s2">&quot;D5&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;D6&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;D7&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;D8&quot;</span><span class="o">:</span> <span class="s2">&quot;Led&quot;</span>
                    <span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="program-details">
<h2>Program Details<a class="headerlink" href="#program-details" title="Permalink to this headline">¶</a></h2>
<p><strong>Description:</strong> Keep the robot far from the wall for 15-20 cm.</p>
<p><strong>Devices used:</strong></p>
<ul class="simple">
<li><p>EV3 that will operate the robot and will move it using rotate.</p></li>
<li><p>EV3 Range sensor that will always check the distance of the robot from the wall.</p></li>
<li><p>RaspberryPi</p></li>
<li><p>GrovePi that will be attached to the RaspberryPi.</p></li>
</ul>
</div>
<div class="section" id="program-threads">
<h2>Program Threads<a class="headerlink" href="#program-threads" title="Permalink to this headline">¶</a></h2>
<p>Let’s understand what’s going on here</p>
<p><strong>1.</strong></p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Do Something with Data&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;GrovePi&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;D2&quot;</span><span class="p">,</span> <span class="s2">&quot;D4&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">GrovePi</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">D4</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">){</span>
            <span class="nx">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">direction</span> <span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>This thread will be responsible for checking the distance of the robot from the
wall and changing it’s direction in case the distance is less then 15.</p>
<p>It will subscribe to the grovePi port where a sensor will be,
and will read data from this sensor while it runs.</p>
<p><strong>2.</strong></p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Just Right&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">EV3</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">_2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="o">&amp;&amp;</span> <span class="nx">distance</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">){</span>
            <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">}})});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>This thread will be responsible for keeping the robot turning right, using rotate in EV3,
if the distance of the robot is 15-20 cm from the wall - keep right.</p>
<p>It will subscribe to the EV3 port where the engine will be,
and it will always read data from this port to check if it’s 15-20 cm from the wall.</p>
<p><strong>3.</strong></p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Too Far Right&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">EV3</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">_2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">){</span>
            <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">}})});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>This thread will be responsible for keeping the distance of the robot from the wall less than 20
if the distance of the robot is more than 20 cm from the wall - rotate left.</p>
<p>It will subscribe to the EV3 port where the engine will be,
and it will always read data from this port to check if it’s more than 20 cm from the wall.</p>
<p><strong>4.</strong></p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Too Far Left&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Subscribe&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;2&quot;</span><span class="p">]})});</span>

    <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">dataEventSet</span><span class="p">});</span>
        <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">distance</span>  <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">EV3</span><span class="p">.</span><span class="nx">_1</span><span class="p">.</span><span class="nx">_2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">distance</span> <span class="o">&lt;</span> <span class="mi">15</span><span class="p">){</span>
            <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Rotate&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;B&quot;</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="o">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;speed&quot;</span><span class="o">:</span> <span class="mi">15</span><span class="p">}})});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>This thread will be responsible for keeping the distance of the robot from the wall less than 20
if the distance of the robot is more than 20 cm from the wall - rotate right.</p>
<p>It will subscribe to the EV3 port where the engine will be,
and it will always read data from this port to check if it’s less than 15 cm from the wall.</p>
<p><strong>5.</strong></p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Do My Algorithm&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;MyAlgorithm&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;EV3&quot;</span><span class="o">:</span> <span class="p">{</span><span class="mi">1</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Param1&quot;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Param2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Param2_1&quot;</span> <span class="o">:</span> <span class="s2">&quot;Hello&quot;</span><span class="p">}}},</span> <span class="s2">&quot;GrovePi&quot;</span><span class="o">:</span> <span class="p">{</span><span class="mi">2</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Param3&quot;</span><span class="o">:</span> <span class="mi">100</span><span class="p">}}})});</span>
    <span class="kd">var</span> <span class="nx">e</span> <span class="o">=</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">waitFor</span><span class="o">:</span> <span class="nx">AlgorithmEventSet</span><span class="p">});</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span><span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="nx">data</span><span class="p">)});</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>This thread will be responsible for running an algorithm (that the programmer will choose).</p>
<p>It will run “MyAlgorithm” event with the params that the programmer will bring,
and will wait for AlgorithmEventSet to return the result of the algorithm.
When recieving the result from AlgorithmEventSet it will send the data to “Test” event.</p>
<p><strong>6.</strong></p>
<div class="highlight-javascript notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nx">bp</span><span class="p">.</span><span class="nx">registerBThread</span><span class="p">(</span><span class="s2">&quot;Initiation&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
<span class="nx">bp</span><span class="p">.</span><span class="nx">sync</span><span class="p">({</span>
    <span class="nx">block</span><span class="o">:</span> <span class="nx">allEventsButBuildEventSet</span><span class="p">,</span> <span class="nx">request</span><span class="o">:</span> <span class="nx">bp</span><span class="p">.</span><span class="nx">Event</span><span class="p">(</span><span class="s2">&quot;Build&quot;</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;EV3&quot;</span><span class="o">:</span>
                <span class="p">[{</span>
                    <span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;EV3_1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Port&quot;</span><span class="o">:</span> <span class="s2">&quot;rfcomm0&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;UV3&quot;</span><span class="p">}</span>
                <span class="p">}]</span>
            <span class="p">,</span>
            <span class="s2">&quot;GrovePi&quot;</span><span class="o">:</span>
                <span class="p">[{</span>
                    <span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;GrovePi1&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;A0&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;A1&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;A2&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;D2&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;MyLed&quot;</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="o">:</span> <span class="s2">&quot;Led&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;D3&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;D4&quot;</span><span class="o">:</span> <span class="p">{</span><span class="s2">&quot;Name&quot;</span><span class="o">:</span> <span class="s2">&quot;UV&quot;</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="o">:</span> <span class="s2">&quot;Ultrasonic&quot;</span><span class="p">},</span>
                    <span class="s2">&quot;D5&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;D6&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;D7&quot;</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;D8&quot;</span><span class="o">:</span> <span class="s2">&quot;Led&quot;</span>
                <span class="p">}]</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">})</span>
<span class="p">});</span>
</pre></div>
</td></tr></table></div>
<p>This thread will be responsible for building the robot data that will include the boards
that are in the robot (EV3, GrovePi etc’) and the ports that the sensors and actuators are attached to.</p>
<p>It will run “build” event that will block all the other events until it happens.
We want “build” Event to be the first event to run in each program so we will have the robot data.</p>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Project example</a><ul>
<li><a class="reference internal" href="#program-details">Program Details</a></li>
<li><a class="reference internal" href="#program-threads">Program Threads</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="classes.html"
                        title="previous chapter">Packages and Classes</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/example.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="classes.html" title="Packages and Classes"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">RobotBP 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Project example</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2021, Adi Jumah, David Ziegler, Peleg Avraham.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.1.2.
    </div>
  </body>
</html>